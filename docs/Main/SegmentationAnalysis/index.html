<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Main/SegmentationAnalysis" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Segmentation Analysis | Aegle: PhenoCycler Pipeline @ PennTMC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kimpenn.github.io/aegle/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kimpenn.github.io/aegle/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kimpenn.github.io/aegle/docs/Main/SegmentationAnalysis"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Segmentation Analysis | Aegle: PhenoCycler Pipeline @ PennTMC"><meta data-rh="true" name="description" content="This document provides comprehensive information about the segmentation analysis module, which performs detailed evaluation of cell and nucleus segmentation quality, quantifies marker intensity distributions, and analyzes spatial organization patterns in multiplex imaging data."><meta data-rh="true" property="og:description" content="This document provides comprehensive information about the segmentation analysis module, which performs detailed evaluation of cell and nucleus segmentation quality, quantifies marker intensity distributions, and analyzes spatial organization patterns in multiplex imaging data."><link data-rh="true" rel="icon" href="/aegle/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kimpenn.github.io/aegle/docs/Main/SegmentationAnalysis"><link data-rh="true" rel="alternate" href="https://kimpenn.github.io/aegle/docs/Main/SegmentationAnalysis" hreflang="en"><link data-rh="true" rel="alternate" href="https://kimpenn.github.io/aegle/docs/Main/SegmentationAnalysis" hreflang="x-default"><link rel="stylesheet" href="/aegle/assets/css/styles.2ce171b8.css">
<script src="/aegle/assets/js/runtime~main.6aafc55e.js" defer="defer"></script>
<script src="/aegle/assets/js/main.21d91ea8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/aegle/img/aegle_icon.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aegle/"><div class="navbar__logo"><img src="/aegle/img/aegle_icon.svg" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/aegle/img/aegle_icon.svg" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Aegle</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aegle/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kimpenn/aegle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aegle/docs/intro">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aegle/docs/category/experiment-configuration">Experiment Configuration</a><button aria-label="Expand sidebar category &#x27;Experiment Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aegle/docs/category/data-preprocess">Data Preprocess</a><button aria-label="Expand sidebar category &#x27;Data Preprocess&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/aegle/docs/category/main">Main</a><button aria-label="Collapse sidebar category &#x27;Main&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aegle/docs/Main/Overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aegle/docs/Main/Execution">Execution Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aegle/docs/Main/Configuration">Configuration Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aegle/docs/Main/Outputs">Outputs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aegle/docs/Main/Preprocess">Pipeline Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aegle/docs/Main/Troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aegle/docs/Main/SegmentationAnalysis">Segmentation Analysis</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aegle/docs/category/downstream-analysis">Downstream Analysis</a><button aria-label="Expand sidebar category &#x27;Downstream Analysis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aegle/docs/post_analysis">Post-Analysis Visualization</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aegle/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/aegle/docs/category/main"><span itemprop="name">Main</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Segmentation Analysis</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Segmentation Analysis</h1></header>
<p>This document provides comprehensive information about the segmentation analysis module, which performs detailed evaluation of cell and nucleus segmentation quality, quantifies marker intensity distributions, and analyzes spatial organization patterns in multiplex imaging data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-framework">Analysis Framework<a href="#analysis-framework" class="hash-link" aria-label="Direct link to Analysis Framework" title="Direct link to Analysis Framework">​</a></h2>
<p>The segmentation analysis module operates as an optional but highly recommended component that provides critical quality assessment and biological insights. It can be enabled through configuration and generates comprehensive reports on segmentation performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-to-use-segmentation-analysis">When to Use Segmentation Analysis<a href="#when-to-use-segmentation-analysis" class="hash-link" aria-label="Direct link to When to Use Segmentation Analysis" title="Direct link to When to Use Segmentation Analysis">​</a></h3>
<p><strong>Enable for</strong>:</p>
<ul>
<li>Quality control assessments</li>
<li>Method comparison studies</li>
<li>Publication-quality results</li>
<li>Troubleshooting segmentation issues</li>
<li>Spatial biology research</li>
</ul>
<p><strong>Disable for</strong>:</p>
<ul>
<li>High-throughput screening (speed priority)</li>
<li>Limited storage scenarios</li>
<li>Preliminary exploratory analysis</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-architecture">Analysis Architecture<a href="#analysis-architecture" class="hash-link" aria-label="Direct link to Analysis Architecture" title="Direct link to Analysis Architecture">​</a></h3>
<p>The module performs three complementary types of analysis:</p>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph TD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A[Segmentation Results] --&gt; B[Mask Quality Analysis]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; C[Intensity Distribution Analysis]  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; D[Spatial Density Analysis]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B --&gt; E[Quality Metrics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    C --&gt; F[Marker Profiles]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    D --&gt; G[Spatial Statistics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E --&gt; H[Analysis Report]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    F --&gt; H</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    G --&gt; H</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-analysis-components">Core Analysis Components<a href="#core-analysis-components" class="hash-link" aria-label="Direct link to Core Analysis Components" title="Direct link to Core Analysis Components">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-mask-quality-analysis">1. Mask Quality Analysis<a href="#1-mask-quality-analysis" class="hash-link" aria-label="Direct link to 1. Mask Quality Analysis" title="Direct link to 1. Mask Quality Analysis">​</a></h3>
<p><strong>Purpose</strong>: Evaluate the effectiveness of cell-nucleus matching and overall segmentation quality</p>
<p><strong>Mask Types Analyzed</strong>:</p>
<ul>
<li><strong>Original Cell Mask</strong>: Raw cell segmentation from deep learning model</li>
<li><strong>Original Nucleus Mask</strong>: Raw nucleus segmentation from deep learning model</li>
<li><strong>Matched Cell Mask</strong>: Cells successfully paired with nuclei</li>
<li><strong>Matched Nucleus Mask</strong>: Nuclei successfully paired with cells</li>
<li><strong>Unmatched Nucleus Mask</strong>: Nuclei without corresponding cell boundaries</li>
<li><strong>Cell-Outside-Nucleus Mask</strong>: Cytoplasmic regions (cell minus nucleus)</li>
</ul>
<p><strong>Quality Metrics</strong>:</p>
<ul>
<li><strong>Matching Efficiency</strong>: Percentage of nuclei successfully matched to cells</li>
<li><strong>Object Count Comparison</strong>: Cell vs nucleus counts across mask types</li>
<li><strong>Area Distribution</strong>: Size distributions for different object types</li>
<li><strong>Shape Analysis</strong>: Morphological characteristics of matched vs unmatched objects</li>
</ul>
<p><strong>Configuration</strong>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">segmentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Enable comprehensive analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">save_segmentation_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Save mask visualizations</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-intensity-distribution-analysis">2. Intensity Distribution Analysis<a href="#2-intensity-distribution-analysis" class="hash-link" aria-label="Direct link to 2. Intensity Distribution Analysis" title="Direct link to 2. Intensity Distribution Analysis">​</a></h3>
<p><strong>Purpose</strong>: Characterize marker expression patterns across different cellular compartments</p>
<p><strong>Analysis Scope</strong>:</p>
<ul>
<li><strong>Per-Marker Analysis</strong>: Individual analysis for each antibody channel</li>
<li><strong>Per-Compartment Analysis</strong>: Nuclear vs cytoplasmic vs whole-cell intensities</li>
<li><strong>Comparative Analysis</strong>: Matched vs unmatched object comparisons</li>
<li><strong>Statistical Characterization</strong>: Distribution parameters and outlier detection</li>
</ul>
<p><strong>Intensity Metrics</strong>:</p>
<ul>
<li><strong>Mean Intensity</strong>: Average marker expression per object</li>
<li><strong>Median Intensity</strong>: Robust central tendency measure</li>
<li><strong>Intensity Variance</strong>: Measure of expression heterogeneity</li>
<li><strong>Percentile Ranges</strong>: 25th, 75th, 90th, 95th percentiles</li>
<li><strong>Coefficient of Variation</strong>: Normalized intensity variability</li>
</ul>
<p><strong>Bias Assessment</strong>:</p>
<ul>
<li><strong>Matching Bias</strong>: Comparison of intensity distributions before/after matching</li>
<li><strong>Compartment Bias</strong>: Nuclear vs cytoplasmic expression differences</li>
<li><strong>Size Bias</strong>: Intensity correlation with object size</li>
</ul>
<p><strong>Visualization Outputs</strong>:</p>
<ul>
<li>Intensity distribution histograms per marker</li>
<li>Box plots comparing mask types</li>
<li>Scatter plots showing intensity correlations</li>
<li>Heatmaps of marker co-expression patterns</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-spatial-density-analysis">3. Spatial Density Analysis<a href="#3-spatial-density-analysis" class="hash-link" aria-label="Direct link to 3. Spatial Density Analysis" title="Direct link to 3. Spatial Density Analysis">​</a></h3>
<p><strong>Purpose</strong>: Quantify spatial organization and cell density patterns</p>
<p><strong>Density Metrics</strong>:</p>
<ul>
<li><strong>Global Density</strong>: Overall cells per unit area (cells/mm²)</li>
<li><strong>Local Density</strong>: Density in sliding windows across the tissue</li>
<li><strong>Density Gradients</strong>: Spatial variation in cell density</li>
<li><strong>Clustering Analysis</strong>: Identification of high/low density regions</li>
</ul>
<p><strong>Spatial Scales</strong>:</p>
<ul>
<li><strong>Patch-Level</strong>: Density within individual image patches</li>
<li><strong>Local Windows</strong>: Moving window analysis (configurable size)</li>
<li><strong>Tissue-Level</strong>: Overall tissue architecture characterization</li>
</ul>
<p><strong>Analysis Parameters</strong>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Spatial analysis configuration (advanced)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spatial_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">window_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># pixels for local density calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">step_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">250</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># overlap between windows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">min_objects</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># minimum objects for reliable density estimate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution-and-configuration">Execution and Configuration<a href="#execution-and-configuration" class="hash-link" aria-label="Direct link to Execution and Configuration" title="Direct link to Execution and Configuration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-segmentation-analysis">Enabling Segmentation Analysis<a href="#enabling-segmentation-analysis" class="hash-link" aria-label="Direct link to Enabling Segmentation Analysis" title="Direct link to Enabling Segmentation Analysis">​</a></h3>
<p>The analysis is controlled through the main configuration file:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">segmentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Enable comprehensive analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">save_segmentation_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Save visualization outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">model_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /path/to/segmentation/model</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="programmatic-usage">Programmatic Usage<a href="#programmatic-usage" class="hash-link" aria-label="Direct link to Programmatic Usage" title="Direct link to Programmatic Usage">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aegle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">segmentation_analysis </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> run_segmentation_analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run analysis on processed patches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run_segmentation_analysis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">codex_patches</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-main-pipeline">Integration with Main Pipeline<a href="#integration-with-main-pipeline" class="hash-link" aria-label="Direct link to Integration with Main Pipeline" title="Direct link to Integration with Main Pipeline">​</a></h3>
<p>The analysis runs automatically after segmentation when enabled:</p>
<ol>
<li><strong>Segmentation Completion</strong>: Cell and nucleus masks generated</li>
<li><strong>Cell-Nucleus Matching</strong>: Objects paired across mask types</li>
<li><strong>Analysis Trigger</strong>: Segmentation analysis begins if configured</li>
<li><strong>Result Generation</strong>: Comprehensive analysis outputs created</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="input-data-requirements">Input Data Requirements<a href="#input-data-requirements" class="hash-link" aria-label="Direct link to Input Data Requirements" title="Direct link to Input Data Requirements">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="required-objects">Required Objects<a href="#required-objects" class="hash-link" aria-label="Direct link to Required Objects" title="Direct link to Required Objects">​</a></h3>
<ul>
<li><strong><code>codex_patches</code></strong>: Main patches object containing:<!-- -->
<ul>
<li><code>original_seg_res_batch</code>: Raw segmentation masks per patch</li>
<li><code>matched_seg_res_batch</code>: Post-processed masks with matching results</li>
<li><code>extracted_channel_patches</code>: Image data for all channels</li>
<li><code>patches_metadata</code>: Patch-level quality and spatial information</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-parameters">Configuration Parameters<a href="#configuration-parameters" class="hash-link" aria-label="Direct link to Configuration Parameters" title="Direct link to Configuration Parameters">​</a></h3>
<ul>
<li><strong>Image Resolution</strong>: <code>data.image_mpp</code> for spatial calculations</li>
<li><strong>Analysis Scope</strong>: Which analyses to perform</li>
<li><strong>Visualization Settings</strong>: Output generation preferences</li>
<li><strong>Performance Settings</strong>: Memory and processing optimization</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-quality-requirements">Data Quality Requirements<a href="#data-quality-requirements" class="hash-link" aria-label="Direct link to Data Quality Requirements" title="Direct link to Data Quality Requirements">​</a></h3>
<ul>
<li><strong>Minimum Object Count</strong>: At least 10 objects per patch for reliable statistics</li>
<li><strong>Channel Quality</strong>: Sufficient signal-to-noise ratio in analyzed channels</li>
<li><strong>Segmentation Quality</strong>: Reasonable segmentation success rate (&gt;50% matching)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="comprehensive-output-suite">Comprehensive Output Suite<a href="#comprehensive-output-suite" class="hash-link" aria-label="Direct link to Comprehensive Output Suite" title="Direct link to Comprehensive Output Suite">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="primary-analysis-files">Primary Analysis Files<a href="#primary-analysis-files" class="hash-link" aria-label="Direct link to Primary Analysis Files" title="Direct link to Primary Analysis Files">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="codex_patches_segmentation_analysispickle"><code>codex_patches_segmentation_analysis.pickle</code><a href="#codex_patches_segmentation_analysispickle" class="hash-link" aria-label="Direct link to codex_patches_segmentation_analysispickle" title="Direct link to codex_patches_segmentation_analysispickle">​</a></h4>
<ul>
<li><strong>Content</strong>: Complete analysis results in serialized format</li>
<li><strong>Size</strong>: 10-100MB depending on patch count and marker number</li>
<li><strong>Usage</strong>: Loading results for further analysis or visualization</li>
<li><strong>Structure</strong>: Dictionary with analysis results per patch and summary statistics</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="updated-metadata-files">Updated Metadata Files<a href="#updated-metadata-files" class="hash-link" aria-label="Direct link to Updated Metadata Files" title="Direct link to Updated Metadata Files">​</a></h4>
<ul>
<li><strong><code>patches_metadata.csv</code></strong>: Enhanced with density metrics</li>
<li><strong>Additional Columns</strong>:<!-- -->
<ul>
<li><code>cell_density_per_mm2</code>: Global cell density</li>
<li><code>nucleus_density_per_mm2</code>: Global nucleus density</li>
<li><code>matching_efficiency</code>: Fraction of nuclei successfully matched</li>
<li><code>mean_cell_area</code>: Average cell size in pixels</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="visualization-outputs">Visualization Outputs<a href="#visualization-outputs" class="hash-link" aria-label="Direct link to Visualization Outputs" title="Direct link to Visualization Outputs">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="channel-intensity-analysis">Channel Intensity Analysis<a href="#channel-intensity-analysis" class="hash-link" aria-label="Direct link to Channel Intensity Analysis" title="Direct link to Channel Intensity Analysis">​</a></h4>
<ul>
<li><strong><code>intensity_distributions/</code></strong>: Directory containing per-channel analysis<!-- -->
<ul>
<li><code>{marker}_intensity_distribution.png</code>: Histogram comparisons</li>
<li><code>{marker}_compartment_comparison.png</code>: Nuclear vs cytoplasmic</li>
<li><code>{marker}_bias_analysis.png</code>: Matching bias assessment</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="spatial-density-analysis">Spatial Density Analysis<a href="#spatial-density-analysis" class="hash-link" aria-label="Direct link to Spatial Density Analysis" title="Direct link to Spatial Density Analysis">​</a></h4>
<ul>
<li><strong><code>density_analysis/</code></strong>: Spatial organization visualizations<!-- -->
<ul>
<li><code>cell_density_histogram.png</code>: Distribution of local densities</li>
<li><code>density_heatmap.png</code>: Spatial density map</li>
<li><code>density_gradient_analysis.png</code>: Directional density patterns</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="segmentation-quality-assessment">Segmentation Quality Assessment<a href="#segmentation-quality-assessment" class="hash-link" aria-label="Direct link to Segmentation Quality Assessment" title="Direct link to Segmentation Quality Assessment">​</a></h4>
<ul>
<li><strong><code>segmentation_quality/</code></strong>: Quality control visualizations<!-- -->
<ul>
<li><code>matching_efficiency_summary.png</code>: Overall matching statistics</li>
<li><code>object_size_distributions.png</code>: Size comparison across mask types</li>
<li><code>segmentation_overlay_samples.png</code>: Example segmentation results</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="statistical-summary-files">Statistical Summary Files<a href="#statistical-summary-files" class="hash-link" aria-label="Direct link to Statistical Summary Files" title="Direct link to Statistical Summary Files">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="intensity_bias_summarycsv"><code>intensity_bias_summary.csv</code><a href="#intensity_bias_summarycsv" class="hash-link" aria-label="Direct link to intensity_bias_summarycsv" title="Direct link to intensity_bias_summarycsv">​</a></h4>
<p>Quantitative comparison of intensity distributions:</p>
<table><thead><tr><th>Column</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>marker</code></td><td>Antibody/channel name</td><td>&quot;CD3&quot;, &quot;DAPI&quot;</td></tr><tr><td><code>original_mean</code></td><td>Mean intensity in original masks</td><td>145.67</td></tr><tr><td><code>matched_mean</code></td><td>Mean intensity in matched masks</td><td>142.34</td></tr><tr><td><code>bias_ratio</code></td><td>Ratio of matched/original means</td><td>0.978</td></tr><tr><td><code>p_value</code></td><td>Statistical significance of difference</td><td>0.023</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="density_summarycsv"><code>density_summary.csv</code><a href="#density_summarycsv" class="hash-link" aria-label="Direct link to density_summarycsv" title="Direct link to density_summarycsv">​</a></h4>
<p>Spatial density metrics per patch:</p>
<table><thead><tr><th>Column</th><th>Description</th><th>Units</th></tr></thead><tbody><tr><td><code>patch_id</code></td><td>Patch identifier</td><td>Integer</td></tr><tr><td><code>cell_density</code></td><td>Cells per unit area</td><td>cells/mm²</td></tr><tr><td><code>nucleus_density</code></td><td>Nuclei per unit area</td><td>nuclei/mm²</td></tr><tr><td><code>local_density_cv</code></td><td>Coefficient of variation in local density</td><td>Unitless</td></tr><tr><td><code>clustering_index</code></td><td>Measure of spatial clustering</td><td>0-1 scale</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimization">Performance Optimization<a href="#performance-optimization" class="hash-link" aria-label="Direct link to Performance Optimization" title="Direct link to Performance Optimization">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="computational-considerations">Computational Considerations<a href="#computational-considerations" class="hash-link" aria-label="Direct link to Computational Considerations" title="Direct link to Computational Considerations">​</a></h3>
<p>The segmentation analysis involves intensive computations across large datasets:</p>
<p><strong>Memory Usage</strong>:</p>
<ul>
<li><strong>Intensity Analysis</strong>: Processes all channel data simultaneously</li>
<li><strong>Spatial Analysis</strong>: Requires patch-level coordinate calculations</li>
<li><strong>Visualization</strong>: Generates multiple high-resolution plots</li>
</ul>
<p><strong>Processing Time</strong>:</p>
<ul>
<li><strong>Small Datasets</strong> (&lt;1000 cells/patch): 1-5 minutes per patch</li>
<li><strong>Medium Datasets</strong> (1000-5000 cells/patch): 5-15 minutes per patch</li>
<li><strong>Large Datasets</strong> (&gt;5000 cells/patch): 15-60 minutes per patch</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimization-strategies">Optimization Strategies<a href="#optimization-strategies" class="hash-link" aria-label="Direct link to Optimization Strategies" title="Direct link to Optimization Strategies">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="memory-management">Memory Management<a href="#memory-management" class="hash-link" aria-label="Direct link to Memory Management" title="Direct link to Memory Management">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Reduce memory usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">segmentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">save_segmentation_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Skip image outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Process fewer channels simultaneously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">analysis_scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">max_channels_parallel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Limit concurrent channel processing</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="processing-speed">Processing Speed<a href="#processing-speed" class="hash-link" aria-label="Direct link to Processing Speed" title="Direct link to Processing Speed">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Parallel processing configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> multiprocessing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_cores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> multiprocessing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cpu_count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Limit core usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Memory-conscious processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Objects per batch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage-optimization">Storage Optimization<a href="#storage-optimization" class="hash-link" aria-label="Direct link to Storage Optimization" title="Direct link to Storage Optimization">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Compress large output files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gzip codex_patches_segmentation_analysis.pickle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove intermediate visualization files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -name &quot;*_intermediate.png&quot; -delete</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-performance-issues">Troubleshooting Performance Issues<a href="#troubleshooting-performance-issues" class="hash-link" aria-label="Direct link to Troubleshooting Performance Issues" title="Direct link to Troubleshooting Performance Issues">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="memory-errors">Memory Errors<a href="#memory-errors" class="hash-link" aria-label="Direct link to Memory Errors" title="Direct link to Memory Errors">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Symptoms: MemoryError, process killed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Solutions:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Process fewer patches simultaneously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Reduce visualization output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Increase system swap space</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="slow-processing">Slow Processing<a href="#slow-processing" class="hash-link" aria-label="Direct link to Slow Processing" title="Direct link to Slow Processing">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Symptoms: Analysis takes &amp;gt;1 hour per patch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Solutions:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Reduce number of channels analyzed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Skip spatial density analysis for large patches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Use sampling for very large cell populations</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-pipeline-workflow">Integration with Pipeline Workflow<a href="#integration-with-pipeline-workflow" class="hash-link" aria-label="Direct link to Integration with Pipeline Workflow" title="Direct link to Integration with Pipeline Workflow">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upstream-dependencies">Upstream Dependencies<a href="#upstream-dependencies" class="hash-link" aria-label="Direct link to Upstream Dependencies" title="Direct link to Upstream Dependencies">​</a></h3>
<p>The segmentation analysis requires successful completion of:</p>
<ol>
<li><strong>Image Processing</strong>: Channel extraction and patch generation</li>
<li><strong>Segmentation</strong>: Cell and nucleus mask creation</li>
<li><strong>Cell-Nucleus Matching</strong>: Object pairing across mask types</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="downstream-applications">Downstream Applications<a href="#downstream-applications" class="hash-link" aria-label="Direct link to Downstream Applications" title="Direct link to Downstream Applications">​</a></h3>
<p>Analysis outputs enable:</p>
<ol>
<li><strong>Quality Assessment</strong>: Segmentation pipeline validation</li>
<li><strong>Method Comparison</strong>: Benchmarking different segmentation approaches</li>
<li><strong>Biological Discovery</strong>: Spatial organization insights</li>
<li><strong>Publication Preparation</strong>: High-quality figures and statistics</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-flow-integration">Data Flow Integration<a href="#data-flow-integration" class="hash-link" aria-label="Direct link to Data Flow Integration" title="Direct link to Data Flow Integration">​</a></h3>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph LR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A[Segmented Patches] --&gt; B[Segmentation Analysis]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B --&gt; C[Quality Metrics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B --&gt; D[Intensity Profiles] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B --&gt; E[Spatial Statistics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    C --&gt; F[Pipeline QC]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    D --&gt; G[Cell Profiling]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E --&gt; H[Spatial Biology]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-examples-and-use-cases">Analysis Examples and Use Cases<a href="#analysis-examples-and-use-cases" class="hash-link" aria-label="Direct link to Analysis Examples and Use Cases" title="Direct link to Analysis Examples and Use Cases">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quality-control-assessment">Quality Control Assessment<a href="#quality-control-assessment" class="hash-link" aria-label="Direct link to Quality Control Assessment" title="Direct link to Quality Control Assessment">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Load analysis results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pickle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;codex_patches_segmentation_analysis.pickle&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rb&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    analysis_results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pickle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check overall segmentation quality</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">matching_efficiency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> analysis_results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;summary&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;matching_efficiency&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Cell-nucleus matching: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">matching_efficiency</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.1%</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Identify problematic patches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">poor_patches </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">p </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> p </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> analysis_results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;patches&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;matching_efficiency&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Patches needing attention: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">poor_patches</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="marker-expression-analysis">Marker Expression Analysis<a href="#marker-expression-analysis" class="hash-link" aria-label="Direct link to Marker Expression Analysis" title="Direct link to Marker Expression Analysis">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Analyze intensity bias</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bias_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;intensity_bias_summary.csv&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Find markers with significant bias</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">biased_markers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bias_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bias_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;p_value&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Markers with matching bias:&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">biased_markers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;marker&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bias_ratio&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;p_value&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spatial-organization-study">Spatial Organization Study<a href="#spatial-organization-study" class="hash-link" aria-label="Direct link to Spatial Organization Study" title="Direct link to Spatial Organization Study">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Load density data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">density_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;density_summary.csv&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Analyze spatial heterogeneity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mean_density </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> density_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;cell_density&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">density_cv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> density_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;cell_density&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">std</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> mean_density</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Average cell density: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">mean_density</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.0f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> cells/mm²&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Spatial heterogeneity: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">density_cv</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-to-enable-full-analysis">When to Enable Full Analysis<a href="#when-to-enable-full-analysis" class="hash-link" aria-label="Direct link to When to Enable Full Analysis" title="Direct link to When to Enable Full Analysis">​</a></h3>
<p><strong>Always Enable For</strong>:</p>
<ul>
<li>Publication-quality studies</li>
<li>Method development and validation</li>
<li>Troubleshooting segmentation issues</li>
<li>Spatial biology research</li>
</ul>
<p><strong>Consider Disabling For</strong>:</p>
<ul>
<li>High-throughput screening</li>
<li>Preliminary exploratory analysis</li>
<li>Resource-constrained environments</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-recommendations">Configuration Recommendations<a href="#configuration-recommendations" class="hash-link" aria-label="Direct link to Configuration Recommendations" title="Direct link to Configuration Recommendations">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="standard-analysis">Standard Analysis<a href="#standard-analysis" class="hash-link" aria-label="Direct link to Standard Analysis" title="Direct link to Standard Analysis">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">segmentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">save_segmentation_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="resource-constrained-analysis">Resource-Constrained Analysis<a href="#resource-constrained-analysis" class="hash-link" aria-label="Direct link to Resource-Constrained Analysis" title="Direct link to Resource-Constrained Analysis">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">segmentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">save_segmentation_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Skip visualizations</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="comprehensive-research-analysis">Comprehensive Research Analysis<a href="#comprehensive-research-analysis" class="hash-link" aria-label="Direct link to Comprehensive Research Analysis" title="Direct link to Comprehensive Research Analysis">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">segmentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">segmentation_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">save_segmentation_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Enable additional spatial analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spatial_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enable_clustering_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enable_gradient_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="result-interpretation-guidelines">Result Interpretation Guidelines<a href="#result-interpretation-guidelines" class="hash-link" aria-label="Direct link to Result Interpretation Guidelines" title="Direct link to Result Interpretation Guidelines">​</a></h3>
<ol>
<li><strong>Matching Efficiency</strong>: &gt;70% indicates good segmentation quality</li>
<li><strong>Intensity Bias</strong>: Bias ratio 0.9-1.1 suggests minimal matching artifacts</li>
<li><strong>Spatial Density</strong>: CV &lt;0.5 indicates relatively uniform cell distribution</li>
<li><strong>Object Counts</strong>: Cell count ~90% of nucleus count expected for healthy tissue</li>
</ol>
<p>The segmentation analysis module provides essential quality control and biological insights that enhance the reliability and interpretability of multiplex imaging analysis results.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Main/SegmentationAnalysis.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aegle/docs/Main/Troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aegle/docs/category/downstream-analysis"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Downstream Analysis</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#analysis-framework" class="table-of-contents__link toc-highlight">Analysis Framework</a><ul><li><a href="#when-to-use-segmentation-analysis" class="table-of-contents__link toc-highlight">When to Use Segmentation Analysis</a></li><li><a href="#analysis-architecture" class="table-of-contents__link toc-highlight">Analysis Architecture</a></li></ul></li><li><a href="#core-analysis-components" class="table-of-contents__link toc-highlight">Core Analysis Components</a><ul><li><a href="#1-mask-quality-analysis" class="table-of-contents__link toc-highlight">1. Mask Quality Analysis</a></li><li><a href="#2-intensity-distribution-analysis" class="table-of-contents__link toc-highlight">2. Intensity Distribution Analysis</a></li><li><a href="#3-spatial-density-analysis" class="table-of-contents__link toc-highlight">3. Spatial Density Analysis</a></li></ul></li><li><a href="#execution-and-configuration" class="table-of-contents__link toc-highlight">Execution and Configuration</a><ul><li><a href="#enabling-segmentation-analysis" class="table-of-contents__link toc-highlight">Enabling Segmentation Analysis</a></li><li><a href="#programmatic-usage" class="table-of-contents__link toc-highlight">Programmatic Usage</a></li><li><a href="#integration-with-main-pipeline" class="table-of-contents__link toc-highlight">Integration with Main Pipeline</a></li></ul></li><li><a href="#input-data-requirements" class="table-of-contents__link toc-highlight">Input Data Requirements</a><ul><li><a href="#required-objects" class="table-of-contents__link toc-highlight">Required Objects</a></li><li><a href="#configuration-parameters" class="table-of-contents__link toc-highlight">Configuration Parameters</a></li><li><a href="#data-quality-requirements" class="table-of-contents__link toc-highlight">Data Quality Requirements</a></li></ul></li><li><a href="#comprehensive-output-suite" class="table-of-contents__link toc-highlight">Comprehensive Output Suite</a><ul><li><a href="#primary-analysis-files" class="table-of-contents__link toc-highlight">Primary Analysis Files</a></li><li><a href="#visualization-outputs" class="table-of-contents__link toc-highlight">Visualization Outputs</a></li><li><a href="#statistical-summary-files" class="table-of-contents__link toc-highlight">Statistical Summary Files</a></li></ul></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a><ul><li><a href="#computational-considerations" class="table-of-contents__link toc-highlight">Computational Considerations</a></li><li><a href="#optimization-strategies" class="table-of-contents__link toc-highlight">Optimization Strategies</a></li><li><a href="#troubleshooting-performance-issues" class="table-of-contents__link toc-highlight">Troubleshooting Performance Issues</a></li></ul></li><li><a href="#integration-with-pipeline-workflow" class="table-of-contents__link toc-highlight">Integration with Pipeline Workflow</a><ul><li><a href="#upstream-dependencies" class="table-of-contents__link toc-highlight">Upstream Dependencies</a></li><li><a href="#downstream-applications" class="table-of-contents__link toc-highlight">Downstream Applications</a></li><li><a href="#data-flow-integration" class="table-of-contents__link toc-highlight">Data Flow Integration</a></li></ul></li><li><a href="#analysis-examples-and-use-cases" class="table-of-contents__link toc-highlight">Analysis Examples and Use Cases</a><ul><li><a href="#quality-control-assessment" class="table-of-contents__link toc-highlight">Quality Control Assessment</a></li><li><a href="#marker-expression-analysis" class="table-of-contents__link toc-highlight">Marker Expression Analysis</a></li><li><a href="#spatial-organization-study" class="table-of-contents__link toc-highlight">Spatial Organization Study</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#when-to-enable-full-analysis" class="table-of-contents__link toc-highlight">When to Enable Full Analysis</a></li><li><a href="#configuration-recommendations" class="table-of-contents__link toc-highlight">Configuration Recommendations</a></li><li><a href="#result-interpretation-guidelines" class="table-of-contents__link toc-highlight">Result Interpretation Guidelines</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>